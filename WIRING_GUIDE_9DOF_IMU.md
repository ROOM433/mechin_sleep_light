# 🔌 9축 IMU 센서 배선 가이드

ESP32-DevKitC와 9축 자이로 IMU 센서(ADXL345 + ITG3205 + HMC5883) 연결 방법입니다.

## 📦 필요한 부품

- ESP32-DevKitC 보드
- 9축 IMU 센서 모듈 (ADXL345 + ITG3205 + HMC5883 통합 모듈)
- 점퍼 와이어 (수컷-수컷)
- 브레드보드 (선택사항)
- 4.7kΩ 풀업 저항 2개 (I2C 버스용, 모듈에 내장되어 있을 수 있음)

## 🔌 배선도

### I2C 버스 연결 (모든 센서 공통)

```
ESP32-DevKitC         9축 IMU 센서 모듈
-----------           -----------------
3.3V        ────────>  VCC
GND         ────────>  GND
GPIO 21     ────────>  SDA
GPIO 22     ────────>  SCL
```

### 상세 핀맵

| ESP32 핀 | 기능 | IMU 모듈 핀 | 설명 |
|---------|------|------------|------|
| 3.3V | 전원 | VCC | 3.3V 전원 공급 |
| GND | 접지 | GND | 공통 접지 |
| GPIO 21 | I2C SDA | SDA | 데이터 라인 |
| GPIO 22 | I2C SCL | SCL | 클럭 라인 |

### I2C 주소 확인

각 센서는 다른 I2C 주소를 사용하므로 충돌 없이 같은 버스에 연결 가능합니다:

- **ADXL345** (가속도계): `0x53`
- **ITG3205** (자이로스코프): `0x68`
- **HMC5883** (자기계): `0x1E`

## ⚠️ 주의사항

### 1. 전원 공급
- **반드시 3.3V 사용**: 5V를 연결하면 센서가 손상될 수 있습니다.
- ESP32의 3.3V 핀에서 직접 공급하거나, 안정적인 3.3V 레귤레이터 사용

### 2. I2C 풀업 저항
- 대부분의 IMU 모듈에는 풀업 저항이 내장되어 있습니다.
- 내장되어 있지 않은 경우, SDA와 SCL에 각각 4.7kΩ 저항을 3.3V에 연결

### 3. 배선 길이
- I2C 배선은 가능한 짧게 (30cm 이하 권장)
- 긴 배선은 노이즈와 통신 오류를 유발할 수 있습니다

### 4. 접지 연결
- 모든 GND를 공통으로 연결 (별도 접지 루프 방지)

## 🔧 조립 순서

### 1단계: 전원 연결
1. ESP32의 **3.3V** 핀을 IMU 모듈의 **VCC**에 연결
2. ESP32의 **GND** 핀을 IMU 모듈의 **GND**에 연결

### 2단계: I2C 통신 연결
1. ESP32의 **GPIO 21**을 IMU 모듈의 **SDA**에 연결
2. ESP32의 **GPIO 22**를 IMU 모듈의 **SCL**에 연결

### 3단계: 연결 확인
1. ESP32에 코드 업로드
2. 시리얼 모니터(115200 보드레이트) 열기
3. 다음 메시지 확인:
   ```
   [SENSOR] Using REAL 9-DOF IMU (ADXL345 + ITG3205 + HMC5883)
   [IMU] Calibrating gyro...
   [IMU] Gyro offset: X=0.00 Y=0.00 Z=0.00
   ```

## 🧪 테스트 방법

### 1. I2C 스캔 테스트
Arduino IDE에서 다음 코드로 센서 주소 확인:

```cpp
#include <Wire.h>

void setup() {
  Serial.begin(115200);
  Wire.begin();
  
  Serial.println("Scanning I2C bus...");
  for (byte addr = 1; addr < 127; addr++) {
    Wire.beginTransmission(addr);
    if (Wire.endTransmission() == 0) {
      Serial.print("Found device at 0x");
      Serial.println(addr, HEX);
    }
  }
}

void loop() {}
```

**예상 출력:**
```
Scanning I2C bus...
Found device at 0x1E  (HMC5883)
Found device at 0x53  (ADXL345)
Found device at 0x68  (ITG3205)
```

### 2. 센서 데이터 확인
시리얼 모니터에서 다음 형식의 데이터 확인:

```
Time:12345 Accel[0.023,0.015,1.002] Gyro[0.5,-0.3,0.1] Mag[100.2,200.5,300.1] RPY[0.9,-1.3,45.2] Stage:2 Move:1.002
```

## 🐛 문제 해결

### 센서가 감지되지 않음
1. **배선 확인**: SDA/SCL이 올바르게 연결되었는지 확인
2. **전원 확인**: 3.3V가 정확히 공급되는지 확인
3. **I2C 주소 확인**: 위의 스캔 코드로 센서 주소 확인
4. **풀업 저항**: 풀업 저항이 필요할 수 있음

### 데이터가 0으로 나옴
1. **센서 초기화 확인**: 시리얼 모니터에서 초기화 메시지 확인
2. **캘리브레이션**: 자이로 캘리브레이션이 완료되었는지 확인
3. **센서 손상**: 다른 센서로 교체 테스트

### 노이즈가 많음
1. **배선 길이**: 배선을 짧게 유지
2. **접지**: 모든 GND를 공통으로 연결
3. **전원 안정화**: 커패시터 추가 고려 (100µF)

## 📐 물리적 배치 권장사항

### 침대 설치 시
- 센서를 침대 매트리스 아래 중앙에 배치
- 가능한 평평한 표면에 고정
- 진동을 최소화할 수 있는 위치 선택

### 테스트 시
- 평평한 테이블 위에 배치
- 움직임이 없는 상태에서 캘리브레이션 수행
- 초기화 후 1-2초 대기

## 📚 참고 자료

- **ADXL345 데이터시트**: Analog Devices 공식 문서
- **ITG3205 데이터시트**: InvenSense 공식 문서
- **HMC5883 데이터시트**: Honeywell 공식 문서
- **ESP32 I2C 가이드**: ESP32 공식 문서

## ✅ 체크리스트

조립 완료 후 확인:

- [ ] 3.3V 전원 연결 확인
- [ ] GND 공통 연결 확인
- [ ] SDA (GPIO 21) 연결 확인
- [ ] SCL (GPIO 22) 연결 확인
- [ ] I2C 스캔으로 3개 센서 모두 감지 확인
- [ ] 시리얼 모니터에서 센서 데이터 출력 확인
- [ ] 자이로 캘리브레이션 완료 확인

---

**주의**: 전원을 연결하기 전에 모든 배선을 확인하세요. 잘못된 연결은 센서나 ESP32를 손상시킬 수 있습니다.

